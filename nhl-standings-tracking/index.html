<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <title>NHL Standings Tracker</title>
        <link rel="stylesheet" href="styles.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    </head>
    <body>
        <h1>NHL Points & Standings Tracking - 2021-22</h1>
        <p>Points and Standings Tracking for the 2021-2022 NHL Season</p>

        <div class="container">
            <h3>Points To Date</h3>
            <p>Filter by: conference, division, & number of games played</p>
            <form> <b>Conference</b> <br>
                <input type="radio" id="all" name="conference_filter" value="All">
                <label for="all">All</label><br>
                <input type="radio" id="west" name="conference_filter" value="Western">
                <label for="west">Western</label><br>
                <input type="radio" id="east" name="conference_filter" value="Eastern">
                <label for="east">Eastern</label><br>
                <input type="submit" value="Submit Conference Filter">
            </form>

            <canvas id="myChart"></canvas>

        </div>

        <h3>Standings</h3>
        <form> <b>Display: Current or Projected Points</b> <br>
            <input type="radio" id="current" name="pace_filter" value="current">
            <label for="current">Current</label><br>
            <input type="radio" id="projected" name="pace_filter" value="projected">
            <label for="projected">Projected</label><br>
            <input type="submit" value="Submit Points Pace Filter">
        </form>
        <br>
        <form> <b>Display: Conference or Division</b> <br>
            <input type="radio" id="conf" name="standings_filter" value="conference">
            <label for="conf">Conference</label><br>
            <input type="radio" id="divis" name="standings_filter" value="division">
            <label for="divis">Division</label><br>
            <input type="submit" value="Submit Standings Filter">
        </form>

        <h3>Playoff Picture</h3>
        <p>Link out to separate page to display bracket</p>

        <script>

            const xlabels = [];
            const ypoints = [];
            const teamColors = [];
            chartIt();

            async function getData() {
                const response = await fetch('teams_points_df_updated_12-27-21.csv');
                const data = await response.text();
                //console.log(data);

                const table = data.split('\n').slice(1);
                table.forEach(row => {
                    //const columns = row.split(',');
                    const columns = row.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g);
                    const team = columns[1];
                    xlabels.push(team);
                    const points = columns[10];
                    ypoints.push(points);
                    const colors = columns[columns.length - 1];
                    teamColors.push(colors);
                })
            }

            async function chartIt() {
                await getData();

                //clean arrays for team colors
                for (var i = 0; i < teamColors.length; i++) {
                    teamColors[i] = "rgba".concat(teamColors[i].replace(/"/g, ""));
                }

                const myChart = document.getElementById('myChart').getContext('2d');
                const pointsChart = new Chart(myChart, {
                    type:'bar', // bar, horizontalBar, pie, line, doughnut, radar, polarArea
                    data:{
                        labels: xlabels,
                        datasets:[{
                            label:'Points',
                            data: ypoints,
                            backgroundColor:teamColors,
                            borderWidth:1,
                            borderColor:'#777',
                            hoverBorderWidth:3,
                            hoverBorderColor:'#000'
                        }]
                    },
                    options:{
                        indexAxis:'y',
                        layout:{
                            padding:{
                                left:50,
                                right:50,
                                top:50,
                                bottom:50
                            }
                        },
                        plugins:{
                            indexAxis:'y',
                            title:{
                                display: true,
                                text:'NHL Teams 2021-22 Points'
                            },
                            legend:{
                                display: false
                            },
                        }
                    }
                });
            }
        </script>
    </body>
</html>
